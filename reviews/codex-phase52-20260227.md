# Phase 5.2 コードレビュー（Codex）

対象: `pixoo-display-test.py`
差分: `git diff 9068527~1..9068527 -- pixoo-display-test.py`

※ 現在の `HEAD` は Phase 5.4（`195f646`）のため、`git diff HEAD~1 -- pixoo-display-test.py` は空です。Phase 5.2 本体コミット（`9068527`）をレビュー対象として評価しました。

## 🔴致命的

- なし

## 🟡改善

1. `xN` 表示とワーカー名が同じ行で衝突する
   - `worker_name` は `max_w = DISPLAY_SIZE - 2` で画面幅いっぱいまで使う一方、右上に `xN` を追加描画しており、同一 y 帯で上書き/重なりが発生します。
   - 参照: `pixoo-display-test.py:502`, `pixoo-display-test.py:511`, `pixoo-display-test.py:538`, `pixoo-display-test.py:551`
   - 影響: 長いワーカー名で可読性が大きく低下し、Phase 5.2 の「視認性改善」と逆行するケースがあります。
   - 対応案: `xN` の実幅（`total_w`）を先に計算し、`worker_name` 側の `max_w` から予約幅として差し引く。

2. `get_count_color()` のパレットがフレームごとに再生成される
   - `compose_frame()` 呼び出しごとに `get_count_color()` が実行され、そのたびに `PALETTE` dict を都度構築しています。
   - 参照: `pixoo-display-test.py:240`, `pixoo-display-test.py:246`, `pixoo-display-test.py:543`
   - 影響: 1回あたりは小さいものの常駐描画では無駄な割り当てが継続し、低性能環境では積み上がります。
   - 対応案: `PALETTE` をモジュール定数化して再利用する。

## 🟢良い点

- 行間調整がセットで実施されており、`ROW1` フォント拡大に合わせて `row2_y` を下げているためラベル衝突を避ける意図が明確です。
  - 参照: `pixoo-display-test.py:128`, `pixoo-display-test.py:129`, `pixoo-display-test.py:491`
- `xN` の色決定で `count` を `1..7` にクランプしており、範囲外値でも KeyError にならない実装です。
  - 参照: `pixoo-display-test.py:255`
- 右上カウントにアウトライン描画を使っており、小型 LED でも背景に埋もれにくいです。
  - 参照: `pixoo-display-test.py:550`, `pixoo-display-test.py:551`

## スコア 89/100

- 致命的なクラッシュ/停止要因はこの差分では見当たりません。
- ただし `xN` とワーカー名のレイアウト競合は、Phase 5.2 の主目的（視認性）に直接影響するため減点対象です。
